<!DOCTYPE html>
<html>
  <head>
    <title>Prueba de mapa Magnitud- Google Maps Api V3</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <!--link rel="stylesheet" type="text/css" href="test.css"-->
    <style>
      html, body, #map_canvas {
        margin: 0;
        padding: 0;
        height: 100%;
      }
    </style>
     <style type="text/css">
       .labels {
         color: white;
         /*background-color: black;*/
         font-family: "Lucida Grande", "Arial", sans-serif;
         font-size: 10px;
         text-align: center;
         width: 20px;     
         white-space: nowrap;
       }
     </style>
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBeV0tz-7_t5lEo4W9vpv5pYUymtXv2Y5c&v=3.exp&sensor=false&libraries=visualization,geometry"></script>
    <script src="js/markerwithlabel.js"></script>
    <script>
     // Colores mapa
     // http://gmaps-samples-v3.googlecode.com/svn/trunk/styledmaps/wizard/index.html
      var styles = [
      {
        "featureType": "water",
        "elementType": "geometry.fill",
        "stylers": [
          { "visibility": "on" },
          { "color": "#000045" },
          { "lightness": 53 },
          { "gamma": 0.46 },
          { "saturation": -65 }
        ]
      },{
        "featureType": "landscape",
        "stylers": [
          { "saturation": 27 },
          { "lightness": -11 },
          { "gamma": 1 },
          { "color": "#ffffff" }
        ]
      }
    ];
      var map
      function initialize() {
        var mapOptions = {
          zoom: 4,
          center: new google.maps.LatLng(-39.44616,-70.659792),
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          heading: 90,
          tilt: 45,
          scrollwheel:!1,
          //elements:{map:!1,lat:!1,lng:!1,locality:!1,country:!1},
          //draggableMarker:!0,
          panControl: false,
          zoomControl: false,
          mapTypeControl: false,
          scaleControl: false,
          streetViewControl: false,
          overviewMapControl: false
        };
        map = new google.maps.Map(document.getElementById('map_canvas'),
            mapOptions);
        // Colores mapa
        map.setOptions({styles: styles});
        // Datos de ChileTemblores jason
        $.getJSON('http://chiletemblores.cl/webservices/json.php', function(data) {
            $.each(data, function(key, sismo) {   //generate list
              var latLng = new google.maps.LatLng(sismo.lat,sismo.long);
              var marker = new google.maps.Marker({ //Circulo
                  title: getTitle(sismo.mag,key),
                  position: latLng,
                  map: map,
                  icon: getCircle(sismo.mag,key)
              });
             var marker = new MarkerWithLabel({
               position: latLng,
               map: map,
               title: getTitle(sismo.mag,key),
               // draggable: true,
               // raiseOnDrag: true,
               labelContent: sismo.mag,
               labelAnchor: new google.maps.Point(10, 30),
               labelStyle: {opacity: 1.0},
               labelClass: "labels", // the CSS class for the label
               labelInBackground: false,
                  icon:new google.maps.MarkerImage("img/pin.png",
                        new google.maps.Size(30,40),
                        new google.maps.Point(0,0),
                        new google.maps.Point(15,40)),
                  //No es necesaria la sombra
                  // shadow:new google.maps.MarkerImage("img/shadow.png",
                  //       new google.maps.Size(25,9),
                  //       new google.maps.Point(0,0),
                  //       new google.maps.Point(12,5))
             });
              //sismo.ciudad
              //sismo.date
              });
          });
        // Responsive Design gmap api v3
        google.maps.event.addDomListener(map, 'idle', function() {
          calculateCenter();
        });
        google.maps.event.addDomListener(window, 'resize', function() {
          map.setCenter(center);
        });
      }
      // Responsive Design gmap api v3
      function calculateCenter() {
        center = map.getCenter();
      }
      // Metrica de Circulo
      function getCircle(magnitude,key){
        var circle;
        // Si es el primer dato, entonces
        if(key==1)
        {
          circle = {
            path: google.maps.SymbolPath.CIRCLE,
            fillColor: "yellow",
            fillOpacity: 0.4,
            scale: Math.pow(2,magnitude),
            strokeColor: "black",
            strokeWeight: .5
          };
        }
        else
        {
          circle = {
            path: google.maps.SymbolPath.CIRCLE,
            fillColor: "red",
            fillOpacity: 0.4,
            scale: Math.pow(2,magnitude),
            strokeColor: "yellow",
            strokeWeight: .5
          };
        }
        return circle;
      }
      // mouse over
      function getTitle(magnitude,key){
        var title;
        // Si es el primer dato, entonces
        if(key==1)
        {
          title = "Ãšltimo Sismo: " + magnitude;
        }
        else
        {
          title = magnitude;
        }
        return title;
      }
    </script>
  </head>
  <body onload="initialize()">
    <div id="map_canvas"></div>
  </body>
</html>